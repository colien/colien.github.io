var Canvas2Image=function(){var t,e,c=(t=document.createElement("canvas"),{canvas:!!(e=t.getContext("2d")),imageData:!!e.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa}),o="image/octet-stream";function g(t,e,n){var a=t.width,r=t.height;null==e&&(e=a),null==n&&(n=r);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e,o.height=n,i.drawImage(t,0,0,a,r,0,0,e,n),o}function f(t,e,n,a){return(t=g(t,n,a)).toDataURL(e)}function i(t){document.location.href=t}function u(t){var e=document.createElement("img");return e.src=t,e}function m(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function b(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function s(t){var e=t.width,n=t.height;return t.getContext("2d").getImageData(0,0,e,n)}function v(t,e){return"data:"+e+";base64,"+t}function d(t){var e=t.width,n=t.height,a=e*n*3,r=54+a,o=[66,77,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],i=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=(4-3*e%4)%4,c=t.data,g="",f=e<<2,m=n,s=String.fromCharCode;do{for(var v=f*(m-1),d="",l=0;l<e;l++){var p=l<<2;d+=s(c[v+p+2])+s(c[v+p+1])+s(c[v+p])}for(var h=0;h<u;h++)d+=String.fromCharCode(0);g+=d}while(--m);return b(o.concat(i))+b(g)}function a(t,e,n,a){if(c.canvas&&c.dataURL)if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),a=m(a),/bmp/.test(a)){var r=s(g(t,e,n));i(v(d(r),o))}else{i(f(t,a,e,n).replace(a,o))}}function r(t,e,n,a){if(c.canvas&&c.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),a=m(a),/bmp/.test(a)){var r=s(g(t,e,n));return u(v(d(r),"image/bmp"))}return u(f(t,a,e,n))}}return{getBase64Data:function(t,e,n,a){if(c.canvas&&c.dataURL){var r,o;if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),a=m(a),/bmp/.test(a)){var i=s(g(t,e,n));r=d(i)}else r=f(t,a,e,n);var u=r.split("base64,");return u&&1<u.length&&(o=u[1]),o}},saveAsImage:a,saveAsPNG:function(t,e,n){return a(t,e,n,"png")},saveAsJPEG:function(t,e,n){return a(t,e,n,"jpeg")},saveAsGIF:function(t,e,n){return a(t,e,n,"gif")},saveAsBMP:function(t,e,n){return a(t,e,n,"bmp")},convertToImage:r,convertToPNG:function(t,e,n){return r(t,e,n,"png")},convertToJPEG:function(t,e,n){return r(t,e,n,"jpeg")},convertToGIF:function(t,e,n){return r(t,e,n,"gif")},convertToBMP:function(t,e,n){return r(t,e,n,"bmp")}}}();